<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">

</head>



    
    <meta name="robots" content="noindex">




    <title>Velero Docs - </title>


<body id="docs">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        <div class="post-single-hero post-single-hero-short bg-color-med-blue">
            <div class="section">
                <div class="section-content">
                    <h1>Documentation</h1>
                </div>
            </div>
        </div>
        <div class="section section-card pt-4 pb-0">
            <div class="container container-max">
                <div class="row">
                    <div class="col-md-3 toc">
                        <div class="row">
    <div class="dropdown mb-2">
        
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                v1.0.0
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                
                
                

                
                    
                    <a class="dropdown-item"
                       href="/docs/master/hooks/">master</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.4/hooks/">v1.4</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.2/hooks/">v1.3.2</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.1/hooks/">v1.3.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.0/hooks/">v1.3.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.2.0/hooks/">v1.2.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.1.0/hooks/">v1.1.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.0.0/hooks/">v1.0.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.11.0/hooks/">v0.11.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.10.0/hooks/">v0.10.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.9.0/hooks/">v0.9.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.1/hooks/">v0.8.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.0/hooks/">v0.8.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.1/hooks/">v0.7.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.0/hooks/">v0.7.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.6.0/hooks/">v0.6.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.5.0/hooks/">v0.5.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.4.0/hooks/">v0.4.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.3.0/hooks/">v0.3.0</a>
                
            </div>
        
    </div>
</div>
                        <br/>
                        <form class="d-flex align-items-center">
                          <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                                   aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                                   aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                                   dir="auto" style="position: relative; vertical-align: top;">
                          </span>
                        </form>
                        <nav class="navigation">
    
    
    
        
        
        
        

        
            <h3>Introduction</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/index.html">About Velero</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/about">How Velero works</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/locations">About locations</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/support-matrix">Supported platforms</a>
                        
                    </li>
                
            </ul>
        
            <h3>Install</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/install-overview">Overview</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/upgrade-to-1.0">Upgrade to 1.0</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/get-started">Quick Start with In-Cluster Minio</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/aws-config">Run on AWS</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/azure-config">Run on Azure</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/gcp-config">Run on GCP</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/restic">Restic Setup</a>
                        
                    </li>
                
            </ul>
        
            <h3>Use</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/disaster-case">Disaster Recovery</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/migration-case">Cluster migration</a>
                        
                    </li>
                
            </ul>
        
            <h3>Troubleshoot</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/troubleshooting">Troubleshooting</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/debugging-install">Troubleshoot an install or setup</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/debugging-restores">Troubleshoot a restore</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/restic#troubleshooting">Troubleshoot Restic</a>
                        
                    </li>
                
            </ul>
        
            <h3>Customize Velero</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/build-from-source">Build from source</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/namespace">Run in any namespace</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/extend">Extend</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/plugins">Extend with plugins</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/hooks">Extend with hooks</a>
                        
                    </li>
                
            </ul>
        
            <h3>More information</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/output-file-format">Backup file format</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/api-types">API types</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.0.0/faq">FAQ</a>
                        
                    </li>
                
            </ul>
        
    
</nav>

                    </div>
                    <div class="col-md-8">
                        
    
    <div class="alert alert-primary" role="alert">
        
            <p>
                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                Documentation for version v1.0.0 is no longer actively maintained.
                The version you are currently viewing is a static snapshot.
                For up-to-date documentation, see the <a href="/docs/v1.4/hooks/">latest version</a>.
            </p>
        
    </div>

                        <div class="documentation-container">
                            <h1 id="hooks">Hooks</h1>
<p>Velero currently supports executing commands in containers in pods during a backup.</p>
<h2 id="backup-hooks">Backup Hooks</h2>
<p>When performing a backup, you can specify one or more commands to execute in a container in a pod
when that pod is being backed up. The commands can be configured to run <em>before</em> any custom action
processing (&ldquo;pre&rdquo; hooks), or after all custom actions have been completed and any additional items
specified by custom action have been backed up (&ldquo;post&rdquo; hooks). Note that hooks are <em>not</em> executed within a shell
on the containers.</p>
<p>There are two ways to specify hooks: annotations on the pod itself, and in the Backup spec.</p>
<h3 id="specifying-hooks-as-pod-annotations">Specifying Hooks As Pod Annotations</h3>
<p>You can use the following annotations on a pod to make Velero execute a hook when backing up the pod:</p>
<h4 id="pre-hooks">Pre hooks</h4>
<ul>
<li><code>pre.hook.backup.velero.io/container</code>
<ul>
<li>The container where the command should be executed. Defaults to the first container in the pod. Optional.</li>
</ul>
</li>
<li><code>pre.hook.backup.velero.io/command</code>
<ul>
<li>The command to execute. If you need multiple arguments, specify the command as a JSON array, such as <code>[&quot;/usr/bin/uname&quot;, &quot;-a&quot;]</code></li>
</ul>
</li>
<li><code>pre.hook.backup.velero.io/on-error</code>
<ul>
<li>What to do if the command returns a non-zero exit code.  Defaults to Fail. Valid values are Fail and Continue. Optional.</li>
</ul>
</li>
<li><code>pre.hook.backup.velero.io/timeout</code>
<ul>
<li>How long to wait for the command to execute. The hook is considered in error if the command exceeds the timeout. Defaults to 30s. Optional.</li>
</ul>
</li>
</ul>
<h4 id="post-hooks">Post hooks</h4>
<ul>
<li><code>post.hook.backup.velero.io/container</code>
<ul>
<li>The container where the command should be executed. Defaults to the first container in the pod. Optional.</li>
</ul>
</li>
<li><code>post.hook.backup.velero.io/command</code>
<ul>
<li>The command to execute. If you need multiple arguments, specify the command as a JSON array, such as <code>[&quot;/usr/bin/uname&quot;, &quot;-a&quot;]</code></li>
</ul>
</li>
<li><code>post.hook.backup.velero.io/on-error</code>
<ul>
<li>What to do if the command returns a non-zero exit code.  Defaults to Fail. Valid values are Fail and Continue. Optional.</li>
</ul>
</li>
<li><code>post.hook.backup.velero.io/timeout</code>
<ul>
<li>How long to wait for the command to execute. The hook is considered in error if the command exceeds the timeout. Defaults to 30s. Optional.</li>
</ul>
</li>
</ul>
<h3 id="specifying-hooks-in-the-backup-spec">Specifying Hooks in the Backup Spec</h3>
<p>Please see the documentation on the 

    

<a href="/docs/v1.0.0/api-types/backup/">Backup API Type</a> for how to specify hooks in the Backup
spec.</p>
<h2 id="hook-example-with-fsfreeze">Hook Example with fsfreeze</h2>
<p>We are going to walk through using both pre and post hooks for freezing a file system. Freezing the
file system is useful to ensure that all pending disk I/O operations have completed prior to taking a snapshot.</p>
<p>We will be using 

<a href="https://github.com/vmware-tanzu/velero/blob/v1.0.0/examples/nginx-app/with-pv.yaml">examples/nginx-app/with-pv.yaml</a> for this example. Follow the 

    

<a href="">steps for your provider</a> to
setup this example.</p>
<h3 id="annotations">Annotations</h3>
<p>The Velero 

<a href="https://github.com/vmware-tanzu/velero/blob/v1.0.0/examples/nginx-app/with-pv.yaml">example/nginx-app/with-pv.yaml</a> serves as an example of adding the pre and post hook annotations directly
to your declarative deployment. Below is an example of what updating an object in place might look like.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl annotate pod -n nginx-example -l app<span style="color:#f92672">=</span>nginx <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pre.hook.backup.velero.io/command<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;[&#34;/sbin/fsfreeze&#34;, &#34;--freeze&#34;, &#34;/var/log/nginx&#34;]&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    pre.hook.backup.velero.io/container<span style="color:#f92672">=</span>fsfreeze <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    post.hook.backup.velero.io/command<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;[&#34;/sbin/fsfreeze&#34;, &#34;--unfreeze&#34;, &#34;/var/log/nginx&#34;]&#39;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    post.hook.backup.velero.io/container<span style="color:#f92672">=</span>fsfreeze
</code></pre></div><p>Now test the pre and post hooks by creating a backup. You can use the Velero logs to verify that the pre and post
hooks are running and exiting without error.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">velero backup create nginx-hook-test

velero backup get nginx-hook-test
velero backup logs nginx-hook-test | grep hookCommand
</code></pre></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '3d80f66bb5ecf85f8e2760caef383f24',
        indexName: 'velero',
        inputSelector: '.docsearch-input',
        algoliaOptions: {'facetFilters': ["version:v1.0.0"]},
        debug: false 
    });
</script>
</body>

</html>
