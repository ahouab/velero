<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">

</head>



    
    <meta name="robots" content="noindex">




    <title>Velero Docs - </title>


<body id="docs">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        <div class="post-single-hero post-single-hero-short bg-color-med-blue">
            <div class="section">
                <div class="section-content">
                    <h1>Documentation</h1>
                </div>
            </div>
        </div>
        <div class="section section-card pt-4 pb-0">
            <div class="container container-max">
                <div class="row">
                    <div class="col-md-3 toc">
                        <div class="row">
    <div class="dropdown mb-2">
        
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                v0.11.0
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                
                
                

                
                    
                    <a class="dropdown-item"
                       href="/docs/master/aws-config/">master</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.4/aws-config/">v1.4</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.2/aws-config/">v1.3.2</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.1/aws-config/">v1.3.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.0/aws-config/">v1.3.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.2.0/aws-config/">v1.2.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.1.0/aws-config/">v1.1.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.0.0/aws-config/">v1.0.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.11.0/aws-config/">v0.11.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.10.0/aws-config/">v0.10.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.9.0/aws-config/">v0.9.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.1/aws-config/">v0.8.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.0/aws-config/">v0.8.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.1/aws-config/">v0.7.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.0/aws-config/">v0.7.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.6.0/aws-config/">v0.6.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.5.0/aws-config/">v0.5.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.4.0/aws-config/">v0.4.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.3.0/aws-config/">v0.3.0</a>
                
            </div>
        
    </div>
</div>
                        <br/>
                        <form class="d-flex align-items-center">
                          <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                                   aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                                   aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                                   dir="auto" style="position: relative; vertical-align: top;">
                          </span>
                        </form>
                        <nav class="navigation">
    
    
    
        
        
        
        

        
            <h3>Introduction</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/index.html">About Velero</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/get-started">Getting started</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/versions">Get the right Velero version</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/about">How Velero works</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/support-matrix">Supported platforms</a>
                        
                    </li>
                
            </ul>
        
            <h3>Upgrade</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/migrating-to-velero">Upgrade from Ark to Velero</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/locations">About locations</a>
                        
                    </li>
                
            </ul>
        
            <h3>Install</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/install-overview">Set up Velero</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/aws-config">Run on AWS</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/gcp-config">Run on GCP</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/azure-config">Run on Azure</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/ibm-config">IBM Cloud Object Store</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/restic">Restic Setup</a>
                        
                    </li>
                
            </ul>
        
            <h3>Troubleshooting</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/troubleshooting">Troubleshooting</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/debugging-install">Troubleshoot an install or setup</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/debugging-restores">Troubleshoot a restore</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/restic#troubleshooting">Troubleshoot Restic</a>
                        
                    </li>
                
            </ul>
        
            <h3>Customize Velero</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/build-from-scratch">Build from source</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/namespace">Run in any namespace</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/extend">Extend</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/plugins">Extend with plugins</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/hooks">Extend with hooks</a>
                        
                    </li>
                
            </ul>
        
            <h3>More information</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/output-file-format">Backup file format</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/api-types">API types</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/faq">FAQ</a>
                        
                    </li>
                
            </ul>
        
            <h3>Tutorials</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/disaster-case">Disaster Recovery</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.11.0/migration-case">Cluster migration</a>
                        
                    </li>
                
            </ul>
        
    
</nav>

                    </div>
                    <div class="col-md-8">
                        
    
    <div class="alert alert-primary" role="alert">
        
            <p>
                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                Documentation for version v0.11.0 is no longer actively maintained.
                The version you are currently viewing is a static snapshot.
                For up-to-date documentation, see the <a href="/docs/v1.4/aws-config/">latest version</a>.
            </p>
        
    </div>

                        <div class="documentation-container">
                            <h1 id="run-velero-on-aws">Run Velero on AWS</h1>
<p>To set up Velero on AWS, you:</p>
<ul>
<li>Download an official release of Velero</li>
<li>Create your S3 bucket</li>
<li>Create an AWS IAM user for Velero</li>
<li>Configure the server</li>
<li>Create a Secret for your credentials</li>
</ul>
<p>If you do not have the <code>aws</code> CLI locally installed, follow the 

<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html">user guide</a> to set it up.</p>
<h2 id="download-velero">Download Velero</h2>
<ol>
<li>
<p>Download the 

<a href="https://github.com/heptio/velero/releases">latest release&rsquo;s</a> tarball for your client platform.</p>
</li>
<li>
<p>Extract the tarball:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tar -xvf &lt;RELEASE-TARBALL-NAME&gt;.tar.gz -C /dir/to/extract/to 
</code></pre></div><p>We&rsquo;ll refer to the directory you extracted to as the &ldquo;Velero directory&rdquo; in subsequent steps.</p>
</li>
<li>
<p>Move the <code>velero</code> binary from the Velero directory to somewhere in your PATH.</p>
</li>
</ol>
<p><em>We strongly recommend that you use an 

<a href="https://github.com/heptio/velero/releases">official release</a> of Velero. The tarballs for each release contain the
<code>velero</code> command-line client <strong>and</strong> version-specific sample YAML files for deploying Velero to your cluster. The code and sample YAML files in the master
branch of the Velero repository are under active development and are not guaranteed to be stable. Use them at your own risk!</em></p>
<h2 id="create-s3-bucket">Create S3 bucket</h2>
<p>Velero requires an object storage bucket to store backups in, preferrably unique to a single Kubernetes cluster (see the 

    

<a href="/docs/v0.11.0/faq/">FAQ</a> for more details). Create an S3 bucket, replacing placeholders appropriately:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws s3api create-bucket <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --bucket &lt;YOUR_BUCKET&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --region &lt;YOUR_REGION&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --create-bucket-configuration LocationConstraint<span style="color:#f92672">=</span>&lt;YOUR_REGION&gt;
</code></pre></div><p>NOTE: us-east-1 does not support a <code>LocationConstraint</code>.  If your region is <code>us-east-1</code>, omit the bucket configuration:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws s3api create-bucket <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --bucket &lt;YOUR_BUCKET&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --region us-east-1
</code></pre></div><h2 id="create-iam-user">Create IAM user</h2>
<p>For more information, see 

<a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html">the AWS documentation on IAM users</a>.</p>
<ol>
<li>
<p>Create the IAM user:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws iam create-user --user-name velero
</code></pre></div><blockquote>
<p>If you&rsquo;ll be using Velero to backup multiple clusters with multiple S3 buckets, it may be desirable to create a unique username per cluster rather than the default <code>velero</code>.</p>
</blockquote>
</li>
<li>
<p>Attach policies to give <code>velero</code> the necessary permissions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">BUCKET<span style="color:#f92672">=</span>&lt;YOUR_BUCKET&gt;
cat &gt; velero-policy.json <span style="color:#e6db74">&lt;&lt;EOF
</span><span style="color:#e6db74">{
</span><span style="color:#e6db74">    &#34;Version&#34;: &#34;2012-10-17&#34;,
</span><span style="color:#e6db74">    &#34;Statement&#34;: [
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Action&#34;: [
</span><span style="color:#e6db74">                &#34;ec2:DescribeVolumes&#34;,
</span><span style="color:#e6db74">                &#34;ec2:DescribeSnapshots&#34;,
</span><span style="color:#e6db74">                &#34;ec2:CreateTags&#34;,
</span><span style="color:#e6db74">                &#34;ec2:CreateVolume&#34;,
</span><span style="color:#e6db74">                &#34;ec2:CreateSnapshot&#34;,
</span><span style="color:#e6db74">                &#34;ec2:DeleteSnapshot&#34;
</span><span style="color:#e6db74">            ],
</span><span style="color:#e6db74">            &#34;Resource&#34;: &#34;*&#34;
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Action&#34;: [
</span><span style="color:#e6db74">                &#34;s3:GetObject&#34;,
</span><span style="color:#e6db74">                &#34;s3:DeleteObject&#34;,
</span><span style="color:#e6db74">                &#34;s3:PutObject&#34;,
</span><span style="color:#e6db74">                &#34;s3:AbortMultipartUpload&#34;,
</span><span style="color:#e6db74">                &#34;s3:ListMultipartUploadParts&#34;
</span><span style="color:#e6db74">            ],
</span><span style="color:#e6db74">            &#34;Resource&#34;: [
</span><span style="color:#e6db74">                &#34;arn:aws:s3:::${BUCKET}/*&#34;
</span><span style="color:#e6db74">            ]
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Action&#34;: [
</span><span style="color:#e6db74">                &#34;s3:ListBucket&#34;
</span><span style="color:#e6db74">            ],
</span><span style="color:#e6db74">            &#34;Resource&#34;: [
</span><span style="color:#e6db74">                &#34;arn:aws:s3:::${BUCKET}&#34;
</span><span style="color:#e6db74">            ]
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">    ]
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">EOF</span>

aws iam put-user-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --user-name velero <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --policy-name velero <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --policy-document file://velero-policy.json
</code></pre></div></li>
<li>
<p>Create an access key for the user:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws iam create-access-key --user-name velero
</code></pre></div><p>The result should look like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"> {
    <span style="color:#f92672">&#34;AccessKey&#34;</span>: {
          <span style="color:#f92672">&#34;UserName&#34;</span>: <span style="color:#e6db74">&#34;velero&#34;</span>,
          <span style="color:#f92672">&#34;Status&#34;</span>: <span style="color:#e6db74">&#34;Active&#34;</span>,
          <span style="color:#f92672">&#34;CreateDate&#34;</span>: <span style="color:#e6db74">&#34;2017-07-31T22:24:41.576Z&#34;</span>,
          <span style="color:#f92672">&#34;SecretAccessKey&#34;</span>: <span style="color:#960050;background-color:#1e0010">&lt;AWS_SECRET_ACCESS_KEY&gt;</span>,
          <span style="color:#f92672">&#34;AccessKeyId&#34;</span>: <span style="color:#960050;background-color:#1e0010">&lt;AWS_ACCESS_KEY_ID&gt;</span>
      }
 }
</code></pre></div></li>
<li>
<p>Create a Velero-specific credentials file (<code>credentials-velero</code>) in your local directory:</p>
<pre><code>[default]
aws_access_key_id=&lt;AWS_ACCESS_KEY_ID&gt;
aws_secret_access_key=&lt;AWS_SECRET_ACCESS_KEY&gt;
</code></pre><p>where the access key id and secret are the values returned from the <code>create-access-key</code> request.</p>
</li>
</ol>
<h2 id="credentials-and-configuration">Credentials and configuration</h2>
<p>In the Velero directory (i.e. where you extracted the release tarball), run the following to first set up namespaces, RBAC, and other scaffolding. To run in a custom namespace, make sure that you have edited the YAML files to specify the namespace. See 

    

<a href="/docs/v0.11.0/namespace/">Run in custom namespace</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f config/common/00-prereqs.yaml
</code></pre></div><p>Create a Secret. In the directory of the credentials file you just created, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create secret generic cloud-credentials <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --namespace &lt;VELERO_NAMESPACE&gt; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --from-file cloud<span style="color:#f92672">=</span>credentials-velero
</code></pre></div><p>Specify the following values in the example files:</p>
<ul>
<li>
<p>In <code>config/aws/05-backupstoragelocation.yaml</code>:</p>
<ul>
<li>Replace <code>&lt;YOUR_BUCKET&gt;</code> and <code>&lt;YOUR_REGION&gt;</code> (for S3 backup storage, region is optional and will be queried from the AWS S3 API if not provided). See the 

    

<a href="/docs/v0.11.0/api-types/backupstoragelocation/">BackupStorageLocation definition</a> for details.</li>
</ul>
</li>
<li>
<p>In <code>config/aws/06-volumesnapshotlocation.yaml</code>:</p>
<ul>
<li>Replace <code>&lt;YOUR_REGION&gt;</code>. See the 

    

<a href="/docs/v0.11.0/api-types/volumesnapshotlocation/">VolumeSnapshotLocation definition</a> for details.</li>
</ul>
</li>
<li>
<p>(Optional, use only to specify multiple volume snapshot locations) In <code>config/aws/10-deployment.yaml</code> (or <code>config/aws/10-deployment-kube2iam.yaml</code>, as appropriate):</p>
<ul>
<li>Uncomment the <code>--default-volume-snapshot-locations</code> and replace provider locations with the values for your environment.</li>
</ul>
</li>
<li>
<p>(Optional) If you run the nginx example, in file <code>config/nginx-app/with-pv.yaml</code>:</p>
<ul>
<li>Replace <code>&lt;YOUR_STORAGE_CLASS_NAME&gt;</code> with <code>gp2</code>. This is AWS&rsquo;s default <code>StorageClass</code> name.</li>
</ul>
</li>
<li>
<p>(Optional) If you have multiple clusters and you want to support migration of resources between them, in file <code>config/aws/10-deployment.yaml</code>:</p>
<ul>
<li>
<p>Uncomment the environment variable <code>AWS_CLUSTER_NAME</code> and replace <code>&lt;YOUR_CLUSTER_NAME&gt;</code> with the current cluster&rsquo;s name. When restoring backup, it will make Velero (and cluster it&rsquo;s running on) claim ownership of AWS volumes created from snapshots taken on different cluster.
The best way to get the current cluster&rsquo;s name is to either check it with used deployment tool or to read it directly from the EC2 instances tags.</p>
<p>The following listing shows how to get the cluster&rsquo;s nodes EC2 Tags. First, get the nodes external IDs (EC2 IDs):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get nodes -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.items[*].spec.externalID}&#39;</span>
</code></pre></div><p>Copy one of the returned IDs <code>&lt;ID&gt;</code> and use it with the <code>aws</code> CLI tool to search for one of the following:</p>
<ul>
<li>
<p>The <code>kubernetes.io/cluster/&lt;AWS_CLUSTER_NAME&gt;</code> tag of the value <code>owned</code>. The <code>&lt;AWS_CLUSTER_NAME&gt;</code> is then your cluster&rsquo;s name:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 describe-tags --filters <span style="color:#e6db74">&#34;Name=resource-id,Values=&lt;ID&gt;&#34;</span> <span style="color:#e6db74">&#34;Name=value,Values=owned&#34;</span>
</code></pre></div></li>
<li>
<p>If the first output returns nothing, then check for the legacy Tag <code>KubernetesCluster</code> of the value <code>&lt;AWS_CLUSTER_NAME&gt;</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 describe-tags --filters <span style="color:#e6db74">&#34;Name=resource-id,Values=&lt;ID&gt;&#34;</span> <span style="color:#e6db74">&#34;Name=key,Values=KubernetesCluster&#34;</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="start-the-server">Start the server</h2>
<p>In the root of your Velero directory, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f config/aws/05-backupstoragelocation.yaml
kubectl apply -f config/aws/06-volumesnapshotlocation.yaml
kubectl apply -f config/aws/10-deployment.yaml
</code></pre></div><h2 id="alternative-setup-permissions-using-kube2iam">ALTERNATIVE: Setup permissions using kube2iam</h2>
<p>

<a href="https://github.com/jtblin/kube2iam">Kube2iam</a> is a Kubernetes application that allows managing AWS IAM permissions for pod via annotations rather than operating on API keys.</p>
<blockquote>
<p>This path assumes you have <code>kube2iam</code> already running in your Kubernetes cluster. If that is not the case, please install it first, following the docs here: 

<a href="https://github.com/jtblin/kube2iam">https://github.com/jtblin/kube2iam</a></p>
</blockquote>
<p>It can be set up for Velero by creating a role that will have required permissions, and later by adding the permissions annotation on the velero deployment to define which role it should use internally.</p>
<ol>
<li>
<p>Create a Trust Policy document to allow the role being used for EC2 management &amp; assume kube2iam role:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt; velero-trust-policy.json <span style="color:#e6db74">&lt;&lt;EOF
</span><span style="color:#e6db74">{
</span><span style="color:#e6db74">    &#34;Version&#34;: &#34;2012-10-17&#34;,
</span><span style="color:#e6db74">    &#34;Statement&#34;: [
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Principal&#34;: {
</span><span style="color:#e6db74">                &#34;Service&#34;: &#34;ec2.amazonaws.com&#34;
</span><span style="color:#e6db74">            },
</span><span style="color:#e6db74">            &#34;Action&#34;: &#34;sts:AssumeRole&#34;
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Principal&#34;: {
</span><span style="color:#e6db74">                &#34;AWS&#34;: &#34;arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:role/&lt;ROLE_CREATED_WHEN_INITIALIZING_KUBE2IAM&gt;&#34;
</span><span style="color:#e6db74">            },
</span><span style="color:#e6db74">            &#34;Action&#34;: &#34;sts:AssumeRole&#34;
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">    ]
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">EOF</span>
</code></pre></div></li>
<li>
<p>Create the IAM role:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws iam create-role --role-name velero --assume-role-policy-document file://./velero-trust-policy.json
</code></pre></div></li>
<li>
<p>Attach policies to give <code>velero</code> the necessary permissions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">BUCKET<span style="color:#f92672">=</span>&lt;YOUR_BUCKET&gt;
cat &gt; velero-policy.json <span style="color:#e6db74">&lt;&lt;EOF
</span><span style="color:#e6db74">{
</span><span style="color:#e6db74">    &#34;Version&#34;: &#34;2012-10-17&#34;,
</span><span style="color:#e6db74">    &#34;Statement&#34;: [
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Action&#34;: [
</span><span style="color:#e6db74">                &#34;ec2:DescribeVolumes&#34;,
</span><span style="color:#e6db74">                &#34;ec2:DescribeSnapshots&#34;,
</span><span style="color:#e6db74">                &#34;ec2:CreateTags&#34;,
</span><span style="color:#e6db74">                &#34;ec2:CreateVolume&#34;,
</span><span style="color:#e6db74">                &#34;ec2:CreateSnapshot&#34;,
</span><span style="color:#e6db74">                &#34;ec2:DeleteSnapshot&#34;
</span><span style="color:#e6db74">            ],
</span><span style="color:#e6db74">            &#34;Resource&#34;: &#34;*&#34;
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Action&#34;: [
</span><span style="color:#e6db74">                &#34;s3:GetObject&#34;,
</span><span style="color:#e6db74">                &#34;s3:DeleteObject&#34;,
</span><span style="color:#e6db74">                &#34;s3:PutObject&#34;,
</span><span style="color:#e6db74">                &#34;s3:AbortMultipartUpload&#34;,
</span><span style="color:#e6db74">                &#34;s3:ListMultipartUploadParts&#34;
</span><span style="color:#e6db74">            ],
</span><span style="color:#e6db74">            &#34;Resource&#34;: [
</span><span style="color:#e6db74">                &#34;arn:aws:s3:::${BUCKET}/*&#34;
</span><span style="color:#e6db74">            ]
</span><span style="color:#e6db74">        },
</span><span style="color:#e6db74">        {
</span><span style="color:#e6db74">            &#34;Effect&#34;: &#34;Allow&#34;,
</span><span style="color:#e6db74">            &#34;Action&#34;: [
</span><span style="color:#e6db74">                &#34;s3:ListBucket&#34;
</span><span style="color:#e6db74">            ],
</span><span style="color:#e6db74">            &#34;Resource&#34;: [
</span><span style="color:#e6db74">                &#34;arn:aws:s3:::${BUCKET}&#34;
</span><span style="color:#e6db74">            ]
</span><span style="color:#e6db74">        }
</span><span style="color:#e6db74">    ]
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">EOF</span>

aws iam put-role-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --role-name velero <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --policy-name velero-policy <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --policy-document file://./velero-policy.json
</code></pre></div></li>
<li>
<p>Update <code>AWS_ACCOUNT_ID</code> &amp; <code>VELERO_ROLE_NAME</code> in the file <code>config/aws/10-deployment-kube2iam.yaml</code>:</p>
<pre><code>---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
    namespace: velero
    name: velero
spec:
    replicas: 1
    template:
        metadata:
            labels:
                component: velero
            annotations:
                iam.amazonaws.com/role: arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:role/&lt;VELERO_ROLE_NAME&gt;
...
</code></pre></li>
<li>
<p>Run Velero deployment using the file <code>config/aws/10-deployment-kube2iam.yaml</code>.</p>
</li>
</ol>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '3d80f66bb5ecf85f8e2760caef383f24',
        indexName: 'velero',
        inputSelector: '.docsearch-input',
        algoliaOptions: {'facetFilters': ["version:v0.11.0"]},
        debug: false 
    });
</script>
</body>

</html>
