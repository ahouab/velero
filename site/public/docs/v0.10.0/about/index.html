<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">

</head>



    
    <meta name="robots" content="noindex">




    <title>Velero Docs - </title>


<body id="docs">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        <div class="post-single-hero post-single-hero-short bg-color-med-blue">
            <div class="section">
                <div class="section-content">
                    <h1>Documentation</h1>
                </div>
            </div>
        </div>
        <div class="section section-card pt-4 pb-0">
            <div class="container container-max">
                <div class="row">
                    <div class="col-md-3 toc">
                        <div class="row">
    <div class="dropdown mb-2">
        
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                v0.10.0
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                
                
                

                
                    
                    <a class="dropdown-item"
                       href="/docs/master/about/">master</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.4/about/">v1.4</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.2/about/">v1.3.2</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.1/about/">v1.3.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.0/about/">v1.3.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.2.0/about/">v1.2.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.1.0/about/">v1.1.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.0.0/about/">v1.0.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.11.0/about/">v0.11.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.10.0/about/">v0.10.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.9.0/about/">v0.9.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.1/about/">v0.8.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.0/about/">v0.8.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.1/about/">v0.7.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.0/about/">v0.7.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.6.0/about/">v0.6.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.5.0/about/">v0.5.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.4.0/about/">v0.4.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.3.0/about/">v0.3.0</a>
                
            </div>
        
    </div>
</div>
                        <br/>
                        <form class="d-flex align-items-center">
                          <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                                   aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                                   aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                                   dir="auto" style="position: relative; vertical-align: top;">
                          </span>
                        </form>
                        <nav class="navigation">
    
    
    
        
        
        
        

        
            <h3>Introduction</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/index.html">About Ark</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/get-started">Getting started</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/versions">Get the right Ark version</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/about">How Ark works</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/support-matrix">Supported platforms</a>
                        
                    </li>
                
            </ul>
        
            <h3>Upgrade</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/upgrading-to-v0.10">Upgrade to version 0.10</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/locations">About locations (new!)</a>
                        
                    </li>
                
            </ul>
        
            <h3>Install</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/install-overview">Set up Ark</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/aws-config">Run on AWS</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/gcp-config">Run on GCP</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/azure-config">Run on Azure</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/ibm-config">IBM Cloud Object Store</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/restic">Restic Setup</a>
                        
                    </li>
                
            </ul>
        
            <h3>Troubleshooting</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/troubleshooting">Troubleshooting</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/debugging-install">Troubleshoot an install or setup</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/debugging-restores">Troubleshoot a restore</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/restic#troubleshooting">Troubleshoot Restic</a>
                        
                    </li>
                
            </ul>
        
            <h3>Customize Ark</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/build-from-scratch">Build from source</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/namespace">Run in any namespace</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/extend">Extend</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/plugins">Extend with plugins</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/hooks">Extend with hooks</a>
                        
                    </li>
                
            </ul>
        
            <h3>More information</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/output-file-format">Backup file format</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/api-types">API types</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/faq">FAQ</a>
                        
                    </li>
                
            </ul>
        
            <h3>Tutorials</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/disaster-case">Disaster Recovery</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/migration-case">Cluster migration</a>
                        
                    </li>
                
            </ul>
        
    
</nav>

                    </div>
                    <div class="col-md-8">
                        
    
    <div class="alert alert-primary" role="alert">
        
            <p>
                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                Documentation for version v0.10.0 is no longer actively maintained.
                The version you are currently viewing is a static snapshot.
                For up-to-date documentation, see the <a href="/docs/v1.4/about/">latest version</a>.
            </p>
        
    </div>

                        <div class="documentation-container">
                            <h1 id="how-ark-works">How Ark Works</h1>
<p>Each Ark operation &ndash; on-demand backup, scheduled backup, restore &ndash; is a custom resource, defined with a Kubernetes 

<a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/#customresourcedefinitions">Custom Resource Definition (CRD)</a> and stored in 

<a href="https://github.com/coreos/etcd">etcd</a>. Ark also includes controllers that process the custom resources to perform backups, restores, and all related operations.</p>
<p>You can back up or restore all objects in your cluster, or you can filter objects by type, namespace, and/or label.</p>
<p>Ark is ideal for the disaster recovery use case, as well as for snapshotting your application state, prior to performing system operations on your cluster (e.g. upgrades).</p>
<h2 id="on-demand-backups">On-demand backups</h2>
<p>The <strong>backup</strong> operation:</p>
<ol>
<li>
<p>Uploads a tarball of copied Kubernetes objects into cloud object storage.</p>
</li>
<li>
<p>Calls the cloud provider API to make disk snapshots of persistent volumes, if specified.</p>
</li>
</ol>
<p>You can optionally specify hooks to be executed during the backup. For example, you might
need to tell a database to flush its in-memory buffers to disk before taking a snapshot. 

    

<a href="/docs/v0.10.0/hooks/">More about hooks</a>.</p>
<p>Note that cluster backups are not strictly atomic. If Kubernetes objects are being created or edited at the time of backup, they might not be included in the backup. The odds of capturing inconsistent information are low, but it is possible.</p>
<h2 id="scheduled-backups">Scheduled backups</h2>
<p>The <strong>schedule</strong> operation allows you to back up your data at recurring intervals. The first backup is performed when the schedule is first created, and subsequent backups happen at the schedule&rsquo;s specified interval. These intervals are specified by a Cron expression.</p>
<p>Scheduled backups are saved with the name <code>&lt;SCHEDULE NAME&gt;-&lt;TIMESTAMP&gt;</code>, where <code>&lt;TIMESTAMP&gt;</code> is formatted as <em>YYYYMMDDhhmmss</em>.</p>
<h2 id="restores">Restores</h2>
<p>The <strong>restore</strong> operation allows you to restore all of the objects and persistent volumes from a previously created backup. You can also restore only a filtered subset of objects and persistent volumes. Ark supports multiple namespace remapping&ndash;for example, in a single restore, objects in namespace &ldquo;abc&rdquo; can be recreated under namespace &ldquo;def&rdquo;, and the objects in namespace &ldquo;123&rdquo; under &ldquo;456&rdquo;.</p>
<p>The default name of a restore is <code>&lt;BACKUP NAME&gt;-&lt;TIMESTAMP&gt;</code>, where <code>&lt;TIMESTAMP&gt;</code> is formatted as <em>YYYYMMDDhhmmss</em>. You can also specify a custom name. A restored object also includes a label with key <code>ark.heptio.com/restore-name</code> and value <code>&lt;RESTORE NAME&gt;</code>.</p>
<p>You can also run the Ark server in restore-only mode, which disables backup, schedule, and garbage collection functionality during disaster recovery.</p>
<h2 id="backup-workflow">Backup workflow</h2>
<p>When you run <code>ark backup create test-backup</code>:</p>
<ol>
<li>
<p>The Ark client makes a call to the Kubernetes API server to create a <code>Backup</code> object.</p>
</li>
<li>
<p>The <code>BackupController</code> notices the new <code>Backup</code> object and performs validation.</p>
</li>
<li>
<p>The <code>BackupController</code> begins the backup process. It collects the data to back up by querying the API server for resources.</p>
</li>
<li>
<p>The <code>BackupController</code> makes a call to the object storage service &ndash; for example, AWS S3 &ndash; to upload the backup file.</p>
</li>
</ol>
<p>By default, <code>ark backup create</code> makes disk snapshots of any persistent volumes. You can adjust the snapshots by specifying additional flags. Run <code>ark backup create --help</code> to see available flags. Snapshots can be disabled with the option <code>--snapshot-volumes=false</code>.</p>
<p><img src="/img/backup-process.png" alt="19"></p>
<h2 id="set-a-backup-to-expire">Set a backup to expire</h2>
<p>When you create a backup, you can specify a TTL by adding the flag <code>--ttl &lt;DURATION&gt;</code>. If Ark sees that an existing backup resource is expired, it removes:</p>
<ul>
<li>The backup resource</li>
<li>The backup file from cloud object storage</li>
<li>All PersistentVolume snapshots</li>
<li>All associated Restores</li>
</ul>
<h2 id="object-storage-sync">Object storage sync</h2>
<p>Heptio Ark treats object storage as the source of truth. It continuously checks to see that the correct backup resources are always present. If there is a properly formatted backup file in the storage bucket, but no corresponding backup resource in the Kubernetes API, Ark synchronizes the information from object storage to Kubernetes.</p>
<p>This allows restore functionality to work in a cluster migration scenario, where the original backup objects do not exist in the new cluster.</p>
<p>Likewise, if a backup object exists in Kubernetes but not in object storage, it will be deleted from Kubernetes since the backup tarball no longer exists.</p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '3d80f66bb5ecf85f8e2760caef383f24',
        indexName: 'velero',
        inputSelector: '.docsearch-input',
        algoliaOptions: {'facetFilters': ["version:v0.10.0"]},
        debug: false 
    });
</script>
</body>

</html>
