<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">

</head>



    
    <meta name="robots" content="noindex">




    <title>Velero Docs - </title>


<body id="docs">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        <div class="post-single-hero post-single-hero-short bg-color-med-blue">
            <div class="section">
                <div class="section-content">
                    <h1>Documentation</h1>
                </div>
            </div>
        </div>
        <div class="section section-card pt-4 pb-0">
            <div class="container container-max">
                <div class="row">
                    <div class="col-md-3 toc">
                        <div class="row">
    <div class="dropdown mb-2">
        
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                v0.10.0
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                
                
                

                
                    
                    <a class="dropdown-item"
                       href="/docs/master/get-started/">master</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.4/get-started/">v1.4</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.2/get-started/">v1.3.2</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.1/get-started/">v1.3.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.0/get-started/">v1.3.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.2.0/get-started/">v1.2.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.1.0/get-started/">v1.1.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.0.0/get-started/">v1.0.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.11.0/get-started/">v0.11.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.10.0/get-started/">v0.10.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.9.0/get-started/">v0.9.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.1/get-started/">v0.8.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.0/get-started/">v0.8.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.1/get-started/">v0.7.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.0/get-started/">v0.7.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.6.0/get-started/">v0.6.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.5.0/get-started/">v0.5.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.4.0/get-started/">v0.4.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.3.0/get-started/">v0.3.0</a>
                
            </div>
        
    </div>
</div>
                        <br/>
                        <form class="d-flex align-items-center">
                          <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                                   aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                                   aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                                   dir="auto" style="position: relative; vertical-align: top;">
                          </span>
                        </form>
                        <nav class="navigation">
    
    
    
        
        
        
        

        
            <h3>Introduction</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/index.html">About Ark</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/get-started">Getting started</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/versions">Get the right Ark version</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/about">How Ark works</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/support-matrix">Supported platforms</a>
                        
                    </li>
                
            </ul>
        
            <h3>Upgrade</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/upgrading-to-v0.10">Upgrade to version 0.10</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/locations">About locations (new!)</a>
                        
                    </li>
                
            </ul>
        
            <h3>Install</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/install-overview">Set up Ark</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/aws-config">Run on AWS</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/gcp-config">Run on GCP</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/azure-config">Run on Azure</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/ibm-config">IBM Cloud Object Store</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/restic">Restic Setup</a>
                        
                    </li>
                
            </ul>
        
            <h3>Troubleshooting</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/troubleshooting">Troubleshooting</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/debugging-install">Troubleshoot an install or setup</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/debugging-restores">Troubleshoot a restore</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/restic#troubleshooting">Troubleshoot Restic</a>
                        
                    </li>
                
            </ul>
        
            <h3>Customize Ark</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/build-from-scratch">Build from source</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/namespace">Run in any namespace</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/extend">Extend</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/plugins">Extend with plugins</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/hooks">Extend with hooks</a>
                        
                    </li>
                
            </ul>
        
            <h3>More information</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/output-file-format">Backup file format</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/api-types">API types</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/faq">FAQ</a>
                        
                    </li>
                
            </ul>
        
            <h3>Tutorials</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/disaster-case">Disaster Recovery</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.10.0/migration-case">Cluster migration</a>
                        
                    </li>
                
            </ul>
        
    
</nav>

                    </div>
                    <div class="col-md-8">
                        
    
    <div class="alert alert-primary" role="alert">
        
            <p>
                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                Documentation for version v0.10.0 is no longer actively maintained.
                The version you are currently viewing is a static snapshot.
                For up-to-date documentation, see the <a href="/docs/v1.4/get-started/">latest version</a>.
            </p>
        
    </div>

                        <div class="documentation-container">
                            <h1 id="getting-started">Getting started</h1>
<p>The following example sets up the Ark server and client, then backs up and restores a sample application.</p>
<p>For simplicity, the example uses Minio, an S3-compatible storage service that runs locally on your cluster.</p>
<p><strong>NOTE</strong> The example lets you explore basic Ark functionality. Configuring Minio for production is out of scope.</p>
<p>See 

    

<a href="/docs/v0.10.0/install-overview/">Set up Ark on your platform</a> for how to configure Ark for a production environment.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Access to a Kubernetes cluster, version 1.7 or later. Version 1.7.5 or later is required to run <code>ark backup delete</code>.</li>
<li>A DNS server on the cluster</li>
<li><code>kubectl</code> installed</li>
</ul>
<h3 id="download">Download</h3>
<ol>
<li>
<p>Download the 

<a href="https://github.com/heptio/ark/releases">latest release&rsquo;s</a> tarball for your platform.</p>
</li>
<li>
<p>Extract the tarball:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tar -xzf &lt;RELEASE-TARBALL-NAME&gt;.tar.gz -C /dir/to/extract/to 
</code></pre></div><p>We&rsquo;ll refer to the directory you extracted to as the &ldquo;Ark directory&rdquo; in subsequent steps.</p>
</li>
<li>
<p>Move the <code>ark</code> binary from the Ark directory to somewhere in your PATH.</p>
</li>
</ol>
<h2 id="set-up-server">Set up server</h2>
<p>These instructions start the Ark server and a Minio instance that is accessible from within the cluster only. See the following section for information about configuring your cluster for outside access to Minio. Outside access is required to access logs and run <code>ark describe</code> commands.</p>
<ol>
<li>
<p>Start the server and the local storage service. In the Ark directory, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f config/common/00-prereqs.yaml
kubectl apply -f config/minio/
</code></pre></div></li>
<li>
<p>Deploy the example nginx application:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply -f config/nginx-app/base.yaml
</code></pre></div></li>
<li>
<p>Check to see that both the Ark and nginx deployments are successfully created:</p>
<pre><code>kubectl get deployments -l component=ark --namespace=heptio-ark
kubectl get deployments --namespace=nginx-example
</code></pre></li>
</ol>
<h2 id="optional-expose-minio-outside-your-cluster">(Optional) Expose Minio outside your cluster</h2>
<p>When you run commands to get logs or describe a backup, the Ark server generates a pre-signed URL to download the requested items. To access these URLs from outside the cluster &ndash; that is, from your Ark client &ndash; you need to make Minio available outside the cluster. You can:</p>
<ul>
<li>Change the Minio Service type from <code>ClusterIP</code> to <code>NodePort</code>.</li>
<li>Set up Ingress for your cluster, keeping Minio Service type <code>ClusterIP</code>.</li>
</ul>
<p>In Ark 0.10, you can also specify the value of a new <code>publicUrl</code> field for the pre-signed URL in your backup storage config.</p>
<h3 id="expose-minio-with-service-of-type-nodeport">Expose Minio with Service of type NodePort</h3>
<p>The Minio deployment by default specifies a Service of type <code>ClusterIP</code>. You can change this to <code>NodePort</code> to easily expose a cluster service externally if you can reach the node from your Ark client.</p>
<p>You must also get the Minio URL, which you can then specify as the value of the new <code>publicUrl</code> field in your backup storage config.</p>
<ol>
<li>
<p>In <code>examples/minio/00-minio-deployment.yaml</code>, change the value of Service <code>spec.type</code> from <code>ClusterIP</code> to <code>NodePort</code>.</p>
</li>
<li>
<p>Get the Minio URL:</p>
<ul>
<li>
<p>if you&rsquo;re running Minikube:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">minikube service minio --namespace<span style="color:#f92672">=</span>heptio-ark --url
</code></pre></div></li>
<li>
<p>in any other environment:</p>
<ol>
<li>
<p>Get the value of an external IP address or DNS name of any node in your cluster. You must be able to reach this address from the Ark client.</p>
</li>
<li>
<p>Append the value of the NodePort to get a complete URL. You can get this value by running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl -n heptio-ark get svc/minio -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.spec.ports[0].nodePort}&#39;</span>
</code></pre></div></li>
</ol>
</li>
</ul>
</li>
<li>
<p>In <code>examples/minio/05-ark-backupstoragelocation.yaml</code>, uncomment the <code>publicUrl</code> line and provide this Minio URL as the value of the <code>publicUrl</code> field. You must include the <code>http://</code> or <code>https://</code> prefix.</p>
</li>
</ol>
<h3 id="work-with-ingress">Work with Ingress</h3>
<p>Configuring Ingress for your cluster is out of scope for the Ark documentation. If you have already set up Ingress, however, it makes sense to continue with it while you run the example Ark configuration with Minio.</p>
<p>In this case:</p>
<ol>
<li>
<p>Keep the Service type as <code>ClusterIP</code>.</p>
</li>
<li>
<p>In <code>examples/minio/05-ark-backupstoragelocation.yaml</code>, uncomment the <code>publicUrl</code> line and provide the URL and port of your Ingress as the value of the <code>publicUrl</code> field.</p>
</li>
</ol>
<h2 id="back-up">Back up</h2>
<ol>
<li>
<p>Create a backup for any object that matches the <code>app=nginx</code> label selector:</p>
<pre><code>ark backup create nginx-backup --selector app=nginx
</code></pre><p>Alternatively if you want to backup all objects <em>except</em> those matching the label <code>backup=ignore</code>:</p>
<pre><code>ark backup create nginx-backup --selector 'backup notin (ignore)'
</code></pre></li>
<li>
<p>(Optional) Create regularly scheduled backups based on a cron expression using the <code>app=nginx</code> label selector:</p>
<pre><code>ark schedule create nginx-daily --schedule=&quot;0 1 * * *&quot; --selector app=nginx
</code></pre><p>Alternatively, you can use some non-standard shorthand cron expressions:</p>
<pre><code>ark schedule create nginx-daily --schedule=&quot;@daily&quot; --selector app=nginx
</code></pre><p>See the 

<a href="https://godoc.org/github.com/robfig/cron">cron package&rsquo;s documentation</a> for more usage examples.</p>
</li>
<li>
<p>Simulate a disaster:</p>
<pre><code>kubectl delete namespace nginx-example
</code></pre></li>
<li>
<p>To check that the nginx deployment and service are gone, run:</p>
<pre><code>kubectl get deployments --namespace=nginx-example
kubectl get services --namespace=nginx-example
kubectl get namespace/nginx-example
</code></pre><p>You should get no results.</p>
<p>NOTE: You might need to wait for a few minutes for the namespace to be fully cleaned up.</p>
</li>
</ol>
<h2 id="restore">Restore</h2>
<ol>
<li>
<p>Run:</p>
<pre><code>ark restore create --from-backup nginx-backup
</code></pre></li>
<li>
<p>Run:</p>
<pre><code>ark restore get
</code></pre><p>After the restore finishes, the output looks like the following:</p>
<pre><code>NAME                          BACKUP         STATUS      WARNINGS   ERRORS    CREATED                         SELECTOR
nginx-backup-20170727200524   nginx-backup   Completed   0          0         2017-07-27 20:05:24 +0000 UTC   &lt;none&gt;
</code></pre></li>
</ol>
<p>NOTE: The restore can take a few moments to finish. During this time, the <code>STATUS</code> column reads <code>InProgress</code>.</p>
<p>After a successful restore, the <code>STATUS</code> column is <code>Completed</code>, and <code>WARNINGS</code> and <code>ERRORS</code> are 0. All objects in the <code>nginx-example</code> namespace should be just as they were before you deleted them.</p>
<p>If there are errors or warnings, you can look at them in detail:</p>
<pre><code>ark restore describe &lt;RESTORE_NAME&gt;
</code></pre><p>For more information, see 

    

<a href="/docs/v0.10.0/debugging-restores/">the debugging information</a>.</p>
<h2 id="clean-up">Clean up</h2>
<p>If you want to delete any backups you created, including data in object storage and persistent
volume snapshots, you can run:</p>
<pre><code>ark backup delete BACKUP_NAME
</code></pre><p>This asks the Ark server to delete all backup data associated with <code>BACKUP_NAME</code>.  You need to do
this for each backup you want to permanently delete. A future version of Ark will allow you to
delete multiple backups by name or label selector.</p>
<p>Once fully removed, the backup is no longer visible when you run:</p>
<pre><code>ark backup get BACKUP_NAME
</code></pre><p>If you want to uninstall Ark but preserve the backup data in object storage and persistent volume
snapshots, it is safe to remove the <code>heptio-ark</code> namespace and everything else created for this
example:</p>
<pre><code>kubectl delete -f config/common/
kubectl delete -f config/minio/
kubectl delete -f config/nginx-app/base.yaml
</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '3d80f66bb5ecf85f8e2760caef383f24',
        indexName: 'velero',
        inputSelector: '.docsearch-input',
        algoliaOptions: {'facetFilters': ["version:v0.10.0"]},
        debug: false 
    });
</script>
</body>

</html>
