<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">

</head>



    
    <meta name="robots" content="noindex">




    <title>Velero Docs - </title>


<body id="docs">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        <div class="post-single-hero post-single-hero-short bg-color-med-blue">
            <div class="section">
                <div class="section-content">
                    <h1>Documentation</h1>
                </div>
            </div>
        </div>
        <div class="section section-card pt-4 pb-0">
            <div class="container container-max">
                <div class="row">
                    <div class="col-md-3 toc">
                        <div class="row">
    <div class="dropdown mb-2">
        
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                v1.3.0
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                
                
                

                
                    
                    <a class="dropdown-item"
                       href="/docs/master/custom-plugins/">master</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.4/custom-plugins/">v1.4</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.2/custom-plugins/">v1.3.2</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.1/custom-plugins/">v1.3.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.0/custom-plugins/">v1.3.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.2.0/custom-plugins/">v1.2.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.1.0/custom-plugins/">v1.1.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.0.0/custom-plugins/">v1.0.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.11.0/custom-plugins/">v0.11.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.10.0/custom-plugins/">v0.10.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.9.0/custom-plugins/">v0.9.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.1/custom-plugins/">v0.8.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.0/custom-plugins/">v0.8.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.1/custom-plugins/">v0.7.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.0/custom-plugins/">v0.7.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.6.0/custom-plugins/">v0.6.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.5.0/custom-plugins/">v0.5.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.4.0/custom-plugins/">v0.4.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.3.0/custom-plugins/">v0.3.0</a>
                
            </div>
        
    </div>
</div>
                        <br/>
                        <form class="d-flex align-items-center">
                          <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                                   aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                                   aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                                   dir="auto" style="position: relative; vertical-align: top;">
                          </span>
                        </form>
                        <nav class="navigation">
    
    
    
        
        
        
        

        
            <h3>Introduction</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/index.html">About Velero</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/how-velero-works">How Velero works</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/locations">About locations</a>
                        
                    </li>
                
            </ul>
        
            <h3>Install</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/basic-install">Basic Install</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/customize-installation">Customize Installation</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/upgrade-to-1.3">Upgrade to 1.3</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/supported-providers">Supported providers</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/contributions/minio">Evaluation install</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/restic">Restic integration</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/examples">Examples</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/uninstalling">Uninstalling</a>
                        
                    </li>
                
            </ul>
        
            <h3>Use</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/disaster-case">Disaster recovery</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/migration-case">Cluster migration</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/backup-reference">Backup reference</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/restore-reference">Restore reference</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/namespace">Run in any namespace</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/hooks">Extend with hooks</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/csi">CSI Support (beta)</a>
                        
                    </li>
                
            </ul>
        
            <h3>Plugins</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/overview-plugins">Overview</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/custom-plugins">Custom plugins</a>
                        
                    </li>
                
            </ul>
        
            <h3>Troubleshoot</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/troubleshooting">Troubleshooting</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/debugging-install">Troubleshoot an install or setup</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/debugging-restores">Troubleshoot a restore</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/restic#troubleshooting">Troubleshoot Restic</a>
                        
                    </li>
                
            </ul>
        
            <h3>Contribute</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/start-contributing">Start Contributing</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/development">Development</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/build-from-source">Build from source</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/run-locally">Run locally</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/code-standards">Code standards</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/website-guidelines">Website guidelines</a>
                        
                    </li>
                
            </ul>
        
            <h3>More information</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/output-file-format">Backup file format</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/api-types">API types</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/faq">FAQ</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/zenhub">ZenHub</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v1.3.0/support-process">Support Process</a>
                        
                    </li>
                
            </ul>
        
    
</nav>

                    </div>
                    <div class="col-md-8">
                        
    
    <div class="alert alert-primary" role="alert">
        
            <p>
                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                Documentation for version v1.3.0 is no longer actively maintained.
                The version you are currently viewing is a static snapshot.
                For up-to-date documentation, see the <a href="/docs/v1.4/custom-plugins/">latest version</a>.
            </p>
        
    </div>

                        <div class="documentation-container">
                            <h1 id="plugins">Plugins</h1>
<p>Velero has a plugin architecture that allows users to add their own custom functionality to Velero backups &amp; restores without having to modify/recompile the core Velero binary. To add custom functionality, users simply create their own binary containing implementations of Velero&rsquo;s plugin kinds (described below), plus a small amount of boilerplate code to expose the plugin implementations to Velero. This binary is added to a container image that serves as an init container for the Velero server pod and copies the binary into a shared emptyDir volume for the Velero server to access.</p>
<p>Multiple plugins, of any type,  can be implemented in this binary.</p>
<p>A fully-functional 

<a href="https://github.com/vmware-tanzu/velero-plugin-example">sample plugin repository</a> is provided to serve as a convenient starting point for plugin authors.</p>
<h2 id="plugin-naming">Plugin Naming</h2>
<p>When naming your plugin, keep in mind that the name needs to conform to these rules:</p>
<ul>
<li>have two parts separated by &lsquo;/&rsquo;</li>
<li>none of the above parts can be empty</li>
<li>the prefix is a valid DNS subdomain name</li>
<li>a plugin with the same name cannot not already exist</li>
</ul>
<h3 id="some-examples">Some examples:</h3>
<pre><code>- example.io/azure
- 1.2.3.4/5678
- example-with-dash.io/azure
</code></pre><p>You will need to give your plugin(s) a name when registering them by calling the appropriate <code>RegisterX</code> function: <a href="https://github.com/vmware-tanzu/velero/blob/0e0f357cef7cf15d4c1d291d3caafff2eeb69c1e/pkg/plugin/framework/server.go#L42-L60">https://github.com/vmware-tanzu/velero/blob/0e0f357cef7cf15d4c1d291d3caafff2eeb69c1e/pkg/plugin/framework/server.go#L42-L60</a></p>
<h2 id="plugin-kinds">Plugin Kinds</h2>
<p>Velero currently supports the following kinds of plugins:</p>
<ul>
<li><strong>Object Store</strong> - persists and retrieves backups, backup logs and restore logs</li>
<li><strong>Volume Snapshotter</strong> - creates volume snapshots (during backup) and restores volumes from snapshots (during restore)</li>
<li><strong>Backup Item Action</strong> - executes arbitrary logic for individual items prior to storing them in a backup file</li>
<li><strong>Restore Item Action</strong> - executes arbitrary logic for individual items prior to restoring them into a cluster</li>
</ul>
<h2 id="plugin-logging">Plugin Logging</h2>
<p>Velero provides a 

<a href="https://github.com/vmware-tanzu/velero/blob/v1.3.0/pkg/plugin/logger.go">logger</a> that can be used by plugins to log structured information to the main Velero server log or
per-backup/restore logs. It also passes a <code>--log-level</code> flag to each plugin binary, whose value is the value of the same
flag from the main Velero process. This means that if you turn on debug logging for the Velero server via <code>--log-level=debug</code>,
plugins will also emit debug-level logs. See the 

<a href="https://github.com/vmware-tanzu/velero-plugin-example">sample repository</a> for an example of how to use the logger within your plugin.</p>
<h2 id="plugin-configuration">Plugin Configuration</h2>
<p>Velero uses a ConfigMap-based convention for providing configuration to plugins. If your plugin needs to be configured at runtime,
define a ConfigMap like the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: ConfigMap
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#75715e"># any name can be used; Velero uses the labels (below)</span>
  <span style="color:#75715e"># to identify it rather than the name</span>
  <span style="color:#66d9ef">name</span>: my-plugin-config
  
  <span style="color:#75715e"># must be in the namespace where the velero deployment</span>
  <span style="color:#75715e"># is running</span>
  <span style="color:#66d9ef">namespace</span>: velero
  
  <span style="color:#66d9ef">labels</span>:
    <span style="color:#75715e"># this value-less label identifies the ConfigMap as</span>
    <span style="color:#75715e"># config for a plugin (i.e. the built-in change storageclass</span>
    <span style="color:#75715e"># restore item action plugin)</span>
    <span style="color:#66d9ef">velero.io/plugin-config</span>: <span style="color:#e6db74">&#34;&#34;</span>
    
    <span style="color:#75715e"># add a label whose key corresponds to the fully-qualified</span>
    <span style="color:#75715e"># plugin name (e.g. mydomain.io/my-plugin-name), and whose</span>
    <span style="color:#75715e"># value is the plugin type (BackupItemAction, RestoreItemAction,</span>
    <span style="color:#75715e"># ObjectStore, or VolumeSnapshotter)</span>
    <span style="color:#66d9ef">&lt;fully-qualified-plugin-name&gt;</span>: &lt;plugin-type<span style="color:#e6db74">&gt;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">data:</span>
  <span style="color:#75715e"># add your configuration data here as key-value pairs</span>
</code></pre></div><p>Then, in your plugin&rsquo;s implementation, you can read this ConfigMap to fetch the necessary configuration. See the 

<a href="https://github.com/vmware-tanzu/velero/blob/v1.3.0/pkg/restore/restic_restore_action.go">restic restore action</a>
for an example of this &ndash; in particular, the <code>getPluginConfig(...)</code> function.</p>
<h2 id="feature-flags">Feature Flags</h2>
<p>Velero will pass any known features flags as a comma-separated list of strings to the <code>--features</code> argument.</p>
<p>Once parsed into a <code>[]string</code>, the features can then be registered using the <code>NewFeatureFlagSet</code> function and queried with <code>features.Enabled(&lt;featureName&gt;)</code>.</p>
<h2 id="environment-variables">Environment Variables</h2>
<p>Velero adds the <code>LD_LIBRARY_PATH</code> into the list of environment variables to provide the convenience for plugins that requires C libraries/extensions in the runtime.</p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '3d80f66bb5ecf85f8e2760caef383f24',
        indexName: 'velero',
        inputSelector: '.docsearch-input',
        algoliaOptions: {'facetFilters': ["version:v1.3.0"]},
        debug: false 
    });
</script>
</body>

</html>
