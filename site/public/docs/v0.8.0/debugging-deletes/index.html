<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">

</head>



    
    <meta name="robots" content="noindex">




    <title>Velero Docs - </title>


<body id="docs">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        <div class="post-single-hero post-single-hero-short bg-color-med-blue">
            <div class="section">
                <div class="section-content">
                    <h1>Documentation</h1>
                </div>
            </div>
        </div>
        <div class="section section-card pt-4 pb-0">
            <div class="container container-max">
                <div class="row">
                    <div class="col-md-3 toc">
                        <div class="row">
    <div class="dropdown mb-2">
        
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                v0.8.0
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                
                
                

                
                    
                    <a class="dropdown-item"
                       href="/docs/master/debugging-deletes/">master</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.4/debugging-deletes/">v1.4</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.2/debugging-deletes/">v1.3.2</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.1/debugging-deletes/">v1.3.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.3.0/debugging-deletes/">v1.3.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.2.0/debugging-deletes/">v1.2.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.1.0/debugging-deletes/">v1.1.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v1.0.0/debugging-deletes/">v1.0.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.11.0/debugging-deletes/">v0.11.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.10.0/debugging-deletes/">v0.10.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.9.0/debugging-deletes/">v0.9.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.1/debugging-deletes/">v0.8.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.8.0/debugging-deletes/">v0.8.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.1/debugging-deletes/">v0.7.1</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.7.0/debugging-deletes/">v0.7.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.6.0/debugging-deletes/">v0.6.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.5.0/debugging-deletes/">v0.5.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.4.0/debugging-deletes/">v0.4.0</a>
                
                    
                    <a class="dropdown-item"
                       href="/docs/v0.3.0/debugging-deletes/">v0.3.0</a>
                
            </div>
        
    </div>
</div>
                        <br/>
                        <form class="d-flex align-items-center">
                          <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="search" class="form-control docsearch-input" id="search-input" placeholder="Search..."
                                   aria-label="Search for..." autocomplete="off" spellcheck="false" role="combobox"
                                   aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0"
                                   dir="auto" style="position: relative; vertical-align: top;">
                          </span>
                        </form>
                        <nav class="navigation">
    
    
    
        
        
        
        

        
            <h3>Introduction</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/index.html">Getting started</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/about">About Ark</a>
                        
                    </li>
                
            </ul>
        
            <h3>Install</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/cloud-common">Set up with cloud provider</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/aws-config">Run on AWS</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/gcp-config">Run on GCP</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/azure-config">Run on Azure</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/ibm-config">IBM Cloud Object Store</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/config-definition">Configuration reference</a>
                        
                    </li>
                
            </ul>
        
            <h3>Troubleshooting</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/troubleshooting">Troubleshooting</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/debugging-deletes">Troubleshoot a backup delete</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/debugging-restores">Troubleshoot a restore</a>
                        
                    </li>
                
            </ul>
        
            <h3>Customize Ark</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/build-from-scratch">Build from source</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/namespace">Run in any namespace</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/extend">Extend</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/plugins">Extend with plugins</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/hooks">Extend with hooks</a>
                        
                    </li>
                
            </ul>
        
            <h3>More information</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/output-file-format">Backup file format</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/api-types">API types</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/faq">FAQ</a>
                        
                    </li>
                
            </ul>
        
            <h3>Tutorials</h3>
            <ul>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/use-cases">Disaster Recovery</a>
                        
                    </li>
                
                    <li>
                        
                            <a href="/docs/v0.8.0/use-cases.html#cluster-migration">Cluster migration</a>
                        
                    </li>
                
            </ul>
        
    
</nav>

                    </div>
                    <div class="col-md-8">
                        
    
    <div class="alert alert-primary" role="alert">
        
            <p>
                <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                Documentation for version v0.8.0 is no longer actively maintained.
                The version you are currently viewing is a static snapshot.
                For up-to-date documentation, see the <a href="/docs/v1.4/debugging-deletes/">latest version</a>.
            </p>
        
    </div>

                        <div class="documentation-container">
                            <h1 id="ark-version-070-and-later-issue-with-deleting-namespaces-and-backups">Ark version 0.7.0 and later: issue with deleting namespaces and backups</h1>
<p>Version 0.7.0 introduced the ability to delete backups. However, you may encounter an issue if you try to
delete the <code>heptio-ark</code> namespace. The namespace can get stuck in a terminating state, and you cannot delete your backups.
To fix:</p>
<ol>
<li>
<p>If you don&rsquo;t have it, 

<a href="https://stedolan.github.io/jq/">install <code>jq</code></a>.</p>
</li>
<li>
<p>Run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash &lt;<span style="color:#f92672">(</span>kubectl -n heptio-ark get backup -o json | jq -c -r <span style="color:#e6db74">$&#39;.items[] | &#34;kubectl -n heptio-ark patch backup/&#34; + .metadata.name + &#34; -p \&#39;&#34; + (({metadata: {finalizers: ( (.metadata.finalizers // []) - [&#34;gc.ark.heptio.com&#34;]), resourceVersion: .metadata.resourceVersion}}) | tostring) + &#34;\&#39; --type=merge&#34;&#39;</span><span style="color:#f92672">)</span>
</code></pre></div></li>
</ol>
<p>This command retrieves a list of backups, then generates and runs another list of commands that look like:</p>
<pre><code>kubectl -n heptio-ark patch backup/my-backup -p '{&quot;metadata&quot;:{&quot;finalizers&quot;:[],&quot;resourceVersion&quot;:&quot;461343&quot;}}' --type=merge
kubectl -n heptio-ark patch backup/some-other-backup -p '{&quot;metadata&quot;:{&quot;finalizers&quot;:[],&quot;resourceVersion&quot;:&quot;461718&quot;}}' --type=merge
</code></pre><p>If you encounter errors that tell you patching backups is not allowed, the Ark
CustomResourceDefinitions (CRDs) might have been deleted. To fix, recreate the CRDs using
<code>examples/common/00-prereqs.yaml</code>, then follow the steps above.</p>
<h2 id="mitigate-the-issue-in-ark-version-071-and-later">Mitigate the issue in Ark version 0.7.1 and later</h2>
<p>In Ark version 0.7.1, the default configuration runs the Ark server in a different namespace from the namespace
for backups, schedules, restores, and the Ark config. We strongly recommend that you keep this configuration.
This approach can help prevent issues with deletes.</p>
<h2 id="for-the-curious-why-the-error-occurs">For the curious: why the error occurs</h2>
<p>The Ark team added the ability to delete backups by adding a <strong>finalizer</strong> to each
backup. When you request the deletion of an object that has at least one finalizer, Kubernetes sets
the object&rsquo;s deletion timestamp, which indicates that the object is marked for deletion. However, it does
not immediately delete the object. Instead, the object is deleted only when it no longer has
any finalizers. This means that something &ndash; in this case, Ark &ndash; must process the backup and then
remove the Ark finalizer from it.</p>
<p>Ark versions earlier than v0.7.1 place the Ark server pod in the same namespace as backups, restores,
schedules, and the Ark config. If you try to delete the namespace, with <code>kubectl delete namespace/heptio-ark</code>, the Ark server pod might be deleted before the backups, because
the order of deletions is arbitrary. If this happens, the remaining bacukps are stuck in a
deleting state, because the Ark server pod no longer exists to remove their finalizers.</p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '3d80f66bb5ecf85f8e2760caef383f24',
        indexName: 'velero',
        inputSelector: '.docsearch-input',
        algoliaOptions: {'facetFilters': ["version:v0.8.0"]},
        debug: false 
    });
</script>
</body>

</html>
