<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    
    
    <link rel="stylesheet" href="/styles.666a5dc1cd80e47092a71103358e46b56345de6f3044680f856f219cbc2fe91b.css" integrity="sha256-Zmpdwc2A5HCSpxEDNY5GtWNF3m8wRGgPhW8hnLwv6Rs=">
    <title>Velero Velero 1.3: Improved CRD Backups/Restores, Multi-Arch Docker Images, and More!</title>
    
</head>
<body id="blog">
<div class="container-fluid site-outer-container">
    <div class="site-container">
        <header class="site-header">
    <div class="site-header-content">
        <div class="logo">
            <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo" alt="Homepage"/></a>
        </div>
        <ul class="nav-menu" id="header-nav">
            <li class="home"><a href="/" title="Velero">Home</a></li>
            <li class="docs"><a href="/docs/v1.4" title="Documentation">Documentation</a></li>
            <li class="plugins"><a href="/plugins" title="Plugins">Plugins</a></li>
            <li class="blog"><a href="/blog" title="Blog Posts">Blog</a></li>
            <li class="community"><a href="/community" title="Community">Community</a></li>
            <li class="resources"><a href="/resources" title="Resources">Resources</a></li>
        </ul>
        <div class="nav-mobile-link">
            <a href="javascript:void(0);" id="nav-mobile-toggle"></a>
        </div>
    </div>
</header>

        
    <div class="post-single-hero bg-color-med-blue">
        <div class="section">
            <div class="section-content">
                <h1>Velero 1.3: Improved CRD Backups/Restores, Multi-Arch Docker Images, and More!</h1>
            </div>
        </div>
    </div>
    <div class="post-single-body">
        <div class="section section-card">
            <div class="section-content pt-4 pb-0">
                <div class="post-single-meta">
                    <div class="post-single-meta-author">
                        

                        <div class="post-single-meta-author-name">
                            <a href="/tags/Steve-Kriss">Steve Kriss</a>
                        </div>
                    </div>

                    <div class="post-single-meta-date">
                        March 02, 2020
                    </div>
                </div>

                <div class="post-single-content">
                    <p>Velero’s voyage continues with the release of version 1.3, which includes improvements to CRD backups and restores, multi-arch Docker images including support for arm/arm64 and ppc64le, and many other usability and stability enhancements. This release includes significant contributions by community members, and we’re thrilled to be able to partner with you all in continuing to improve Velero.</p>
<p>Let’s take a deeper look at some of this release’s highlights.</p>
<h2 id="custom-resource-definition-backup-and-restore-improvements">Custom Resource Definition Backup and Restore Improvements</h2>
<p>This release includes a number of related bug fixes and improvements to how Velero backs up and restores custom resource definitions (CRDs) and instances of those CRDs.</p>
<p>We found and fixed three issues around restoring CRDs that were originally created via the <code>v1beta1</code> CRD API.  The first issue affected CRDs that  had the <code>PreserveUnknownFields</code> field set to <code>true</code>.  These CRDs could not be restored into 1.16+ Kubernetes clusters, because the <code>v1</code> CRD API does not allow this field to be set to <code>true</code>. We added code to the restore process to check for this scenario, to set the <code>PreserveUnknownFields</code> field to <code>false</code>, and to instead set <code>x-kubernetes-preserve-unknown-fields</code> to <code>true</code> in the OpenAPIv3 structural schema, per Kubernetes guidance. For more information on this, see the 

<a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#pruning-versus-preserving-unknown-fields">Kubernetes documentation</a>. The second issue affected CRDs without structural schemas. These CRDs need to be backed up/restored through the <code>v1beta1</code> API, since all CRDs created through the <code>v1</code> API must have structural schemas. We added code to detect these CRDs and always back them up/restore them through the <code>v1beta1</code> API. Finally, related to the previous issue, we found that our restore code was unable to handle backups with multiple API versions for a given resource type, and we’ve remediated this as well.</p>
<p>We also improved the CRD restore process to enable users to properly restore CRDs and instances of those CRDs in a single restore operation. Previously, users found that they needed to run two separate restores: one to restore the CRD(s), and another to restore instances of the CRD(s).  This was due to two deficiencies in the Velero code. First, Velero did not wait for a CRD to be fully accepted by the Kubernetes API server and ready for serving before moving on; and second, Velero did not refresh its cached list of available APIs in the target cluster after restoring CRDs, so it was not aware that it could restore instances of those CRDs.</p>
<p>We fixed both of these issues by (1) adding code to wait for CRDs to be “ready” after restore before moving on, and (2) refreshing the cached list of APIs after restoring CRDs, so any instances of newly-restored CRDs could subsequently be restored.</p>
<p>With all of these fixes and improvements in place, we hope that the CRD backup and restore experience is now seamless across all supported versions of Kubernetes.</p>
<h2 id="multi-arch-docker-images">Multi-Arch Docker Images</h2>
<p>Thanks to community members 

<a href="https://github.com/Prajyot-Parab">@Prajyot-Parab</a> and 

<a href="https://github.com/shaneutt">@shaneutt</a>, Velero now provides multi-arch container images by using Docker manifest lists.  We are currently publishing images for <code>linux/amd64</code>, <code>linux/arm64</code>, <code>linux/arm</code>, and <code>linux/ppc64le</code> in 

<a href="https://hub.docker.com/r/velero/velero/tags?page=1&amp;name=v1.3&amp;ordering=last_updated">our Docker repository</a>.</p>
<p>Users don’t need to change anything other than updating their version tag - the v1.3 image is <code>velero/velero:v1.3.0</code>, and Docker will automatically pull the proper architecture for the host.</p>
<p>For more information on manifest lists, see 

<a href="https://docs.docker.com/registry/spec/manifest-v2-2/">Docker’s documentation</a>.</p>
<h2 id="bug-fixes-usability-enhancements-and-more">Bug Fixes, Usability Enhancements, and More!</h2>
<p>We fixed a large number of bugs and made some smaller usability improvements in this release. Here are a few highlights:</p>
<ul>
<li>Support private registries with custom ports for the restic restore helper image (

<a href="https://github.com/vmware-tanzu/velero/pull/1999">PR #1999</a>, 

<a href="https://github.com/cognoz">@cognoz</a>)</li>
<li>Use AWS profile from BackupStorageLocation when invoking restic (

<a href="https://github.com/vmware-tanzu/velero/pull/2096">PR #2096</a>, 

<a href="https://github.com/dinesh">@dinesh</a>)</li>
<li>Allow restores from schedules in other clusters (

<a href="https://github.com/vmware-tanzu/velero/pull/2218">PR #2218</a>, 

<a href="https://github.com/cpanato">@cpanato</a>)</li>
<li>Fix memory leak &amp; race condition in restore code (

<a href="https://github.com/vmware-tanzu/velero/pull/2201">PR #2201</a>, 

<a href="https://github.com/skriss">@skriss</a>)</li>
</ul>
<p>For a full list of all changes in this release, see 

<a href="https://github.com/vmware-tanzu/velero/blob/master/changelogs/CHANGELOG-1.3.md">the changelog</a>.</p>
<h2 id="an-update-on-csi-snapshot-support">An Update on CSI Snapshot Support</h2>
<p>Previously, we planned to release version 1.3 around the end of March, with CSI snapshot support as the headline feature.  However, because we had already merged a large number of fixes and improvements since 1.2, and wanted to make them available to users, we decided to release 1.3 early, without the CSI snapshot support.</p>
<p>Our priorities have not changed, and we’re continuing to work hard on adding CSI snapshot support to Velero 1.4, including helping upstream CSI providers migrate to the <code>v1beta1</code> CSI snapshot API where possible. We still anticipate releasing 1.4 with beta support for CSI snapshots in the first half of 2020.</p>
<h2 id="join-the-movement--contribute">Join the Movement – Contribute!</h2>
<p>Velero is better because of our contributors and maintainers. It is because of you that we can bring great software to the community. Please join us during our 

<a href="https://velero.io/community/">online community meetings every Tuesday</a> and catch up with past meetings on YouTube on the 

<a href="https://www.youtube.com/watch?v=nc48ocI-6go&amp;list=PL7bmigfV0EqQRysvqvqOtRNk4L5S7uqwM">Velero Community Meetings playlist</a>.</p>
<p>You can always find the latest project information at 

<a href="https://velero.io">velero.io</a>. Look for issues on GitHub marked 

<a href="https://github.com/vmware-tanzu/velero/issues?q=is:open&#43;is:issue&#43;label:%22Good&#43;first&#43;issue%22">Good first issue</a> or 

<a href="https://github.com/vmware-tanzu/velero/issues?utf8=%e2%9c%93&amp;q=is:open&#43;is:issue&#43;label:%22Help&#43;wanted%22&#43;">Help wanted</a> if you want to roll up your sleeves and write some code with us.</p>
<p>You can chat with us on 

<a href="https://kubernetes.slack.com/messages/C6VCGP4MT">Kubernetes Slack in the #velero channel</a> and follow us on Twitter at 

<a href="https://twitter.com/projectvelero">@projectvelero</a>.</p>

                </div>
            </div>
        </div>
    </div>

    <div class="section pt-3">
        <div class="section-content section-content-thin">
            <h5 class="font-color-darker">Related Content</h5>
<div class="row">
    
        <div class="col-xs col-md-4">
    <div class="card card-light mb-3 mb-md-0 blog-card">
        <div class="card-body match-height">
            <div class="post-thumbnail">
                
                    <img src="/img/posts/sailboat.jpg" alt="Velero 1.2 Sets Sail by Shifting Plugins Out of Tree, Adding a Structural Schema, and Sharpening Usability" />
                
            </div>
            <article class="post">
                <h5 class="text-center font-weight-medium">
                    <a href="/blog/Velero-1.2-Sets-Sail/" class="post-title">Velero 1.2 Sets Sail by Shifting Plugins Out of Tree, Adding a Structural Schema, and Sharpening Usability</a>
                </h5>
                <div class="post-entry">
                    With this release, we’ve focused on extracting in-tree cloud provider plugins into their own repositories, making further usability improvements to the restic integration, preparing for the general availability of Kubernetes custom resource definitions (CRDs) by adding a structural schema to our CRDs, and many other new features and usability improvements.
                </div>
            </article>
        </div>
    </div>
</div>
    
        <div class="col-xs col-md-4">
    <div class="card card-light mb-3 mb-md-0 blog-card">
        <div class="card-body match-height">
            <div class="post-thumbnail">
                
                    <img src="/img/posts/csi-announce-blog.jpg" alt="How to use CSI Volume Snapshotting with Velero" />
                
            </div>
            <article class="post">
                <h5 class="text-center font-weight-medium">
                    <a href="/blog/CSI-integration/" class="post-title">How to use CSI Volume Snapshotting with Velero</a>
                </h5>
                <div class="post-entry">
                    In the Velero 1.4 release, we introduced support for CSI snapshotting v1beta1 APIs. This post provides step-by-step instructions on setting up a CSI environment in Azure, installing Velero 1.4 with the velero-plugin-for-csi, and a demo of this feature in action.
                </div>
            </article>
        </div>
    </div>
</div>
    
</div>
        </div>
    </div>

        <div class="section section-background-darkest-blue">
    <div class="section-content">
        <div class="row">
            <div class="col-xs-12 col-sm-6 col-lg-8">
                <h5>Getting Started</h5>
                <p>To help you get started, see the documentation.</p>
            </div>
            <div class="col-xs-12 col-sm-6 col-lg-3 offset-lg-1">
                <p><strong></strong></p>
                <a href="/docs"
                   class="btn btn-sm btn-primary btn-no-border">Documentation</a>
            </div>
        </div>
    </div>
</div>

<footer class="section site-footer">
    <div class="section-content">
        <div class="row justify-content-between align-items-center">
            <div class="col-12 col-md-8 mb-3 mb-md-0">
                <ul class="social-links text-center text-md-left">
                    
                        <li>
                            
                                <i class="fab fa-twitter fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://twitter.com/projectvelero">Twitter</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-slack fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://kubernetes.slack.com/messages/velero">Slack</a>
                        </li>
                    
                        <li>
                            
                                <i class="fas fa-users fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://groups.google.com/forum/#!forum/projectvelero">Google Groups</a>
                        </li>
                    
                        <li>
                            
                                <i class="fa fa-rss fa-lg fa-fw mr-1"></i>
                            
                            <a href="feed.xml">RSS</a>
                        </li>
                    
                        <li>
                            
                                <i class="fab fa-github fa-lg fa-fw mr-1"></i>
                            
                            <a href="https://github.com/vmware-tanzu/velero">GitHub</a>
                        </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 text-center text-md-right">
                <a href="/" aria-label="Velero homepage"><img src="/img/Velero.svg" class="logo"
                                                              alt="Homepage"/></a>
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col copyright text-center text-md-right mt-4">
                &copy; 2020 Velero Authors.
                <a href="http://vmware.github.io/" class="vm-logo">A VMware-backed project. <img
                            src="/img/vm-logo.png" alt="VMware logo"/></a>
            </div>
        </div>
    </div>
</footer>


<script defer src="https://use.fontawesome.com/releases/v5.8.1/js/all.js"
        integrity="sha384-g5uSoOSBd7KkhAMlnQILrecXvzst9TdC09/VM+pjDTCM+1il8RHz5fKANTFFb+gQ"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>

<script src="/js/jquery.matchHeight.js?1593121911"></script>
<script src="/js/scripts.js?1593121911"></script>

    </div>
</div>
</body>
</html>